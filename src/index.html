<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="utf-8">
    <title>進撃のバゲット</title>
    <link rel="stylesheet" type="text/css" href="./style.css"/>
    <link type="text/javascript" href="./biwascheme.js" />
  </head>
  <body>
    <div class="App">
        <script>
          var app = {}
          app.translations = {
            en: {
              intro: "BiwaScheme is a Scheme interpreter written in JavaScript.",
              instruction: "Please type in some code!",
              resultStr: "Result"
            },
            fr: {
              intro: "Biwascheme est un interpréteur du langage Scheme, écrit en JavaScript.",
              instruction: "Merci d'entrer du code!",
              resultStr: "Résultat"
            },
            ja: {
              intro: "BiwaSchemeは、JavaScriptで書かれたSchemeインタプリタです。",
              instruction: "いくつかのコードを入力してください！",
              resultStr: "結果"
            }
          };

          var currentLanguage = document.documentElement.lang || "en";
          function gettext( key ) {
            return app.lang[ key ] || app.translations.en[ key ] || "{translation key not found: " + key + "}";
          }
        </script>

        <div class="App-header">
          <img src="biwascheme_logo.png" className="App-logo" alt="logo" style="height:105px" />
          <h2>進撃のバゲット</h2>

          <select id="lang-select" onchange="changeLang(this.value)">
            <option value="en">English</option>
            <option value="fr">French</option>
            <option value="ja">日本語</option>
          </select>
        </div>
        <p id="intro" class="App-intro"></p>

        <script type="text/javascript" src="biwascheme.js"></script>
        <script >
        function handleClick() {
          var codeEntry = document.getElementById('code-entry');
          var resultOutput = document.getElementById("result");
          var code = codeEntry.value.toString();
          codeEntry.value = "";
          var console = document.getElementById("bs-console");
          while (console.firstChild) {
            console.removeChild(console.firstChild);
          }
          if (code == "") {
            resultOutput.value = code;
          } else {
            var biwascheme = new BiwaScheme.Interpreter(function(e, state) {
              $('output')[0].innerHTML += e.message;
            });
            var onError = function(e){ console.error(e); }
            var biwa = new BiwaScheme.Interpreter(onError)
            biwa.evaluate(code, function(result) {
              resultOutput.value = result;
            });
          }
        }
        </script>

        <button id="run-button" type="Button" onClick="handleClick()">&#9658;</button>

        <div class="App-content" id="app-content">
          <div class="Code-area">
            <textarea class="Code-entry" id="code-entry"></textarea>
          </div>

          <div class="Result-area">
            <textarea class="Result" id="result" disabled="disabled"></textarea>
          </div>

          <div class="Console-area">
            <div id="console" class="Console">
              <div id="bs-console"></div>
            </div>
          </div>
        </div>

        <script>
          function displayStrings() {
            app.lang = app.translations[ currentLanguage ] || app.translations.en;
            document.getElementById("intro").innerHTML = gettext("intro");
            document.getElementById("code-entry").placeholder = gettext("instruction");
            document.getElementById("result").placeholder = gettext("resultStr");
          }

          function changeLang(lang) {
            currentLanguage = lang;
            displayStrings();
          }

          displayStrings();
        </script>
      </div>
  </body>
</html>
