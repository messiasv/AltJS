<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="utf-8">
    <title>進撃のバゲット</title>
    <link rel="stylesheet" type="text/css" href="./style.css"/>
    <link type="text/javascript" href="lang/biwascheme.js" />
  </head>
  <body>
    <div class="App">
        <script>
          var app = {}
          app.translations = {
            en: {
              scheme: "BiwaScheme is a Scheme interpreter written in JavaScript.",
              prolog: "prolog.js is a Prolog parser, compiler and interpreter written in Javascript.",
              instruction: "Please type in some code!",
              resultStr: "Result"
            },
            fr: {
              scheme: "Biwascheme est un interpréteur du langage Scheme, écrit en JavaScript.",
              prolog: "prolog.js est un parseur, compilateur et interpréteur du langage Prolog, écrit en Javascript.",
              instruction: "Merci d'entrer du code!",
              resultStr: "Résultat"
            },
            ja: {
              scheme: "BiwaScheme は JavaScript で 書かれた Scheme インタプリタです。",
              prolog: "prolog.js は Javascript で 書かれた Prolog パーサ、コンパイラ、インタプリタです。",
              instruction: "いくつかのコードを入力してください！",
              resultStr: "結果"
            }
          };

          app.logo = {
            scheme: "biwascheme.png",
            prolog:"prolog.png"
          }

          var currentLanguage = document.documentElement.lang || "en";
          function gettext( key ) {
            return app.lang[ key ] || app.translations.en[ key ] || "{translation key not found: " + key + "}";
          }

          function getlogo( key ) {
            return "logos/" + app.logo[ key ];
          }

          var currentPgmLanguage = "scheme";
        </script>

        <div class="App-header">
          <img class="App-logo" id="app-logo" alt="logo" style="height:105px" />
          <h2>進撃のバゲット</h2>

          <select id="lang-select" onchange="changeLang(this.value)">
            <option value="en">English</option>
            <option value="fr">French</option>
            <option value="ja">日本語</option>
          </select>

          <select id="pgm-lang-select" onchange="changePgmLang(this.value)">
            <option value="scheme">Scheme</option>
            <option value="prolog">Prolog</option>
          </select>
        </div>
        <p id="intro" class="App-intro"></p>

        <script type="text/javascript" src="lang/biwascheme.js"></script>
        <script >
          function handleClick() {
            var codeEntry = document.getElementById('code-entry');
            var resultOutput = document.getElementById("result");
            var code = codeEntry.value.toString();
            codeEntry.value = "";
            var console = document.getElementById("console");
            while (console.firstChild) {
              console.removeChild(console.firstChild);
            }
            if (code == "") {
              resultOutput.value = code;
            } else {
                switch(currentPgmLanguage) {
                  case "scheme":
                    var biwascheme = new BiwaScheme.Interpreter(function(e, state) {
                      $('output')[0].innerHTML += e.message;
                    });
                    var onError = function(e){ console.error(e); }
                    var biwa = new BiwaScheme.Interpreter(onError)
                    biwa.evaluate(code, function(result) {
                      resultOutput.value = result;
                    });
                    break;
                  case "prolog": // prolog interpretation
                    // TODO: add the prolog interpretation
                    break;
                  default:
                }
            }
          }
        </script>

        <button id="run-button" type="Button" onClick="handleClick()">&#9658;</button>

        <div class="App-content" id="app-content">
          <div class="Code-area">
            <textarea class="Code-entry" id="code-entry"></textarea>
          </div>

          <div class="Result-area">
            <textarea class="Result" id="result" disabled="disabled"></textarea>
          </div>

          <div class="Console-area">
            <div class="Console">
              <div id="console"></div>
            </div>
          </div>
        </div>

        <script>
          function displayStrings() {
            app.lang = app.translations[ currentLanguage ] || app.translations.en;
            document.getElementById("intro").innerHTML = gettext(currentPgmLanguage);
            document.getElementById("code-entry").placeholder = gettext("instruction");
            document.getElementById("result").placeholder = gettext("resultStr");
          }

          function updateLogo() {
            document.getElementById("app-logo").src = getlogo(currentPgmLanguage);
          }

          function changeLang(lang) {
            currentLanguage = lang;
            displayStrings();
          }

          function changePgmLang(lang) {
            currentPgmLanguage = lang;
            displayStrings();
            updateLogo();
          }

          displayStrings();
          updateLogo();
        </script>
      </div>
  </body>
</html>
